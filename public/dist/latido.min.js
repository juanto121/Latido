!function(a,b){function c(b,d){var e,f;if("\x2e"!=b[0]&&"\x2f"!=b[0])return a(b);if(d=d||"\x72\x6f\x6f\x74",e=c.resolve(b),!e&&/\.json$/i.test(b))return a("\x2e\x2f"+c.basename(b));if(f=c.cache[e],!f)try{return a(b)}catch(g){throw Error("\x66\x61\x69\x6c\x65\x64\x20\x74\x6f\x20\x72\x65\x71\x75\x69\x72\x65\x20\x22"+b+"\x22\x20\x66\x72\x6f\x6d\x20"+d+"\n"+g.message+"\n"+g.stack)}return f.exports||(f.exports={},f.call(f.exports,f,f.exports,c.relative(e))),f.exports}c.cache={},c.basename=a("\x70\x61\x74\x68").basename,c.resolve=function(b){var d,e,f,g;if("\x2e"!=b[0])return a.resolve(b);for(d="\x2f"===b.slice(-1)?b:b+"\x2f",e=[b,b+"\x2e\x6a\x73",d+"\x69\x6e\x64\x65\x78\x2e\x6a\x73",b+"\x2e\x6a\x73\x6f\x6e",d+"\x69\x6e\x64\x65\x78\x2e\x6a\x73\x6f\x6e"],f=0;g=e[f];f++)if(c.cache[g])return g},c.register=function(a,b){c.cache[a]=b},c.relative=function(a){function b(b){var d,e,f,g,h;if("\x2e"!=b[0])return c(b);for(d=a.split("\x2f"),e=b.split("\x2f"),d.pop(),f=0,g=e.length;g>f;f+=1)h=e[f],"\x2e\x2e"==h?d.pop():"\x2e"!=h&&d.push(h);return c(d.join("\x2f"),a)}return b.resolve=c.resolve,b.cache=c.cache,b},c.register("\x2e\x2f\x70\x75\x62\x6c\x69\x63\x2f\x64\x69\x73\x74\x2f\x6c\x61\x74\x69\x64\x6f\x2e\x6d\x69\x6e\x2e\x6a\x73",function(){var d=function(){function a(){this.initHrmonitor()}var b=a.prototype;return b.initHrmonitor=function(){this.minBpm=50,this.maxBpm=200,this.fps=60,this.windowDuration=10,this.bufferSize=512,this.buffer=[],this.dataTimes=[],this.dataValues=[]},b.getFps=function(){var a=this.buffer.length,b=this.buffer[a-1].time,c=this.buffer[0].time,d=(b-c)/1e3,e=a/d;return parseInt(e)},b.bufferFull=function(){return this.buffer.length>=this.bufferSize},b.isReady=function(){return this.buffer.length>=2},b.addSample=function(a){this.bufferFull()&&(this.buffer.shift(),this.dataTimes.shift(),this.dataValues.shift()),this.buffer.push(a),this.dataTimes.push(a.time),this.dataValues.push(a.value)},b.getFFT=function(){var a=this.bufferSize,b=this.dataTimes[0],c=this.dataTimes[this.dataTimes.length-1],d=numeric.linspace(b,c,a),e=everpolate.linear(d,this.dataTimes,this.dataValues),f=d.length,g=new FFT(f,this.getFps());return g.forward(e),g.spectrum},b.binToBpm=function(a){return 60*a*this.getFps()/this.bufferSize},b.bpmToBin=function(a){return a*this.bufferSize/(60*this.getFps())},b.getBpm=function(){for(var a=this.getFFT(),b=(a.length,parseInt(this.bpmToBin(this.minBpm))),c=parseInt(this.bpmToBin(this.maxBpm)),d=0,e=0,f=b;c>f;f++)a[f]>d&&(e=f,d=a[f]);return{bpm:this.binToBpm(e),freqs:a}},a}(),e=function(){function a(){this.initCamera()}var b=a.prototype;return b.initCamera=function(){this.cameraReady=!1,this.videoElement=document.querySelector("\x76\x69\x64\x65\x6f"),navigator.getMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getMedia({video:!0,audio:!1},this.onMediaStream.bind(this),this.errMediaStream.bind(this))},b.onMediaStream=function(a){this.mediaStream=a;var b=this,c=this.videoElement;this.videoElement.src=window.URL.createObjectURL(a),this.videoElement.onloadedmetadata=function(){b.cameraReady=!0,c.play()}},b.isReady=function(){return this.cameraReady},b.errMediaStream=function(){console.log("\x4d\x65\x64\x69\x61\x20\x73\x74\x72\x65\x61\x6d\x20\x65\x72\x72\x6f\x72")},a}(),f=function(){function a(){this.initFaceDetector()}var b=a.prototype;return b.initFaceDetector=function(){},b.getFaces=function(a){var b=this;$(a).faceDetection({complete:b.faceDetected.bind(this)})},b.faceDetected=function(a){void 0!==a[0]&&this.listener(a)},b.setListener=function(a){this.listener=a},a}(),g=function(){function a(){this.initFaceTrack()}var b=a.prototype;return b.initFaceTrack=function(){this.fhx=.5,this.fhy=.13,this.fhw=.25,this.fhh=.15},b.update=function(a){this.face=a},b.getForehead=function(){var f,a=this.face[0],b=a.x,c=a.y,d=a.width,e=a.height;return b+=d*this.fhx,c+=e*this.fhy,d*=this.fhw,e*=this.fhh,b-=d/2,c-=e/2,f={x:b,y:c,w:d,h:e}},a}(),h=function(){function a(){this.canvas=document.querySelector("\x63\x61\x6e\x76\x61\x73"),this.ctx=this.canvas.getContext("\x32\x64")}var b=a.prototype;return b.sampleFrame=function(a,b){var k,l,m,n,o,c=b.x,d=b.y,e=b.w,f=b.h,g=0,h=0,i=b.w,j=b.h;for(this.ctx.drawImage(a,c,d,e,f,g,h,i,j),k=this.ctx.getImageData(0,0,e,f),l=k.data.length,m=1,n=0,o=0,m=1;l>m;m+=4)o+=k.data[m],n++;return o/=n,{time:Date.now(),value:o}},a}(),i=function(){function a(){this.init()}var b=a.prototype;return b.init=function(){this.chart=new Rickshaw.Graph({element:document.getElementById("\x63\x68\x61\x72\x74"),height:500,renderer:"\x6c\x69\x6e\x65",series:new Rickshaw.Series.FixedDuration([{name:"\x6f\x6e\x65",color:"\x67\x72\x65\x65\x6e"},{name:"\x74\x77\x6f",color:"\x72\x65\x64"}],void 0,{timeInterval:250,maxDataPoints:100,timeBase:(new Date).getTime()/1e3})}),this.chart.render()},b.updateRawSample=function(a){var b={one:a};this.chart.series.addData(b)},b.updateBpm=function(a){var b={two:a};this.chart.series.addData(b)},b.render=function(){this.chart.render()},a}(),j=function(){function a(){this.init()}var b=a.prototype;return b.init=function(){this.current=Date.now(),this.last=Date.now(),this.seconds=document.getElementById("\x73\x65\x63\x6f\x6e\x64\x73"),this.bpmElement=document.getElementById("\x62\x70\x6d"),this.videoElement=document.querySelector("\x76\x69\x64\x65\x6f"),this.camera=new e,this.hrmonitor=new d,this.faceDetector=new f,this.faceTracker=new g,this.imageproc=new h,this.faceDetector.setListener(this.faceDetected.bind(this)),this.chart=new i},b.updateUI=function(){this.seconds.textContent=(Date.now()-this.startTime)/1e3,this.hrmonitor.buffer.length>=this.hrmonitor.bufferSize-5&&(console.log(this.bpm.bpm),this.bpmElement.textContent=parseInt(this.bpm.bpm))},b.update=function(){this.last=Date.now(),this.last-this.current,this.camera.isReady()&&(this.hrmonitor.isReady()?(this.bpm=this.hrmonitor.getBpm(),this.sampleFrame(),this.updateUI()):(this.faceDetector.getFaces(this.camera.videoElement),this.current=this.last,this.startTime=Date.now())),requestAnimationFrame(this.update.bind(this))},b.faceDetected=function(a){this.faceTracker.update(a),this.sampleFrame()},b.sampleFrame=function(){var a=this.imageproc.sampleFrame(this.videoElement,this.faceTracker.getForehead());return this.hrmonitor.addSample(a),a},a}(),k=function(){function a(){this.init()}var b=a.prototype;return b.init=function(){},a}();window.onload=function(){var a=new j;a.update(),new k}}),b.exports=c("\x2e\x2f\x61\x70\x70\x2e\x6a\x73")}(require,module);